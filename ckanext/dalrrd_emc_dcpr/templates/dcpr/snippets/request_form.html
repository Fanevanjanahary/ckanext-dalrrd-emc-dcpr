{% import 'macros/form.html' as form %}

{% if dcpr_request %}
 {% set is_owner = dcpr_request.owner_user == g.userobj.id %}
 {% set request_submitted = ( dcpr_request.status == 'AWAITING_NSIF_REVIEW' ) %}
 {% set request_under_preparation = ( dcpr_request.status == 'UNDER_PREPARATION' ) %}
 {% set waiting_csi_review = ( dcpr_request.status == 'AWAITING_CSI_REVIEW' ) %}
 {% set immutable = request_submitted and is_owner %}
 {% set status_finalized = dcpr_request.status == 'ACCEPTED' or dcpr_request.status == 'REJECTED' %}
 {% set nsif_review_ready = ( not request_under_preparation and nsif_reviewer ) and ( not waiting_csi_review and not status_finalized ) %}
 {% set csi_review_ready = csi_reviewer and waiting_csi_review %}
 {% set request_id = dcpr_request.csi_reference_id %}
{% endif %}

<form class="dataset-form" method="post" data-module="basic-form" novalidate>
    {% block errors %}{{ form.errors(error_summary) }}{% endblock %}
    {% block fields %}
        {% snippet 'dcpr/snippets/new_request_fields.html', data=data, errors=errors, data_urgency_options=data_urgency %}
    {% endblock %}
    {% block form_actions %}
        <div class="form-actions">
            {% if csi_reference_id and h.check_access("dcpr_request_delete_auth", {"csi_reference_id": csi_reference_id}) %}
                {% link_for _('Delete DCPR request'),
                    named_route="dcpr.dcpr_request_delete",
                    csi_reference_id=csi_reference_id,
                    class_='btn btn-danger pull-left',
                    icon='trash'
                %}
            {% endif %}
            <input type="submit" class="btn btn-primary" value="{{ _('Save') }}">
            {{ form.required_message() }}
        </div>
    {% endblock %}
</form>

{#data-module="confirm-action",#}
{#data-module-content="{{ _('Are you sure you want to delete this DCPR request?') }}"#}
